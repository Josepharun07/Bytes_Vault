<!-- public/dashboard.html -->
<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Admin Dashboard | Bytes Vault</title>
  <link rel="stylesheet" href="css/style.css">
</head>
<body>
  <div class="admin-container">
    <div class="dashboard-header">
      <h2>Product Inventory</h2>
      <button onclick="logout()" class="btn-secondary">Logout</button>
    </div>

    <!-- Note: We kept the table simple as per teammate's design, 
         but added the image column for better visibility -->
    <div class="table-responsive">
      <table id="inventory-table">
        <thead>
          <tr>
            <th>Image</th>
            <th>Name</th>
            <th>Price</th>
            <th>Stock</th>
            <th>Status</th>
          </tr>
        </thead>
        <tbody id="products"></tbody>
      </table>
    </div>
  </div>

  <script>
    async function loadProducts() {
      // INTEGRATION FIX: Use the key 'vault_token' from our auth system
      const token = localStorage.getItem("vault_token");
      const role = localStorage.getItem("vault_role");

      // Security check
      if (!token || role !== 'admin') {
        window.location.href = 'login.html';
        return;
      }

      // INTEGRATION FIX: Correct API endpoint '/api/products'
      const res = await fetch("/api/products", {
        headers: { Authorization: `Bearer ${token}` }
      });

      const result = await res.json(); // Our API returns { success: true, data: [...] }
      const products = result.data || [];

      document.getElementById("products").innerHTML =
        products.map(p => {
            const imgUrl = p.imageUrl || 'uploads/products/no-image.jpg';
            return `
              <tr style="background:${p.stockCount < 5 ? '#fff3cd' : 'white'}">
                <td><img src="${imgUrl}" width="50" style="border-radius:4px"></td>
                <td>${p.itemName}</td>
                <td>$${p.price}</td>
                <td>${p.stockCount}</td>
                <td>${p.stockCount < 5 ? 'Low Stock' : 'OK'}</td>
              </tr>
            `;
        }).join("");
    }

    function logout() {
      localStorage.clear();
      window.location.href = 'login.html';
    }

    loadProducts();
  </script>
</body>
</html>